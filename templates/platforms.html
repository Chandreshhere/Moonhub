<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoonHub Platform Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #ffffff 0%, #f8f9fa 25%, #e9ecef 50%, #6f42c1 75%, #4a1a5a 100%);
            --card-gradient: linear-gradient(145deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.8) 100%);
            --text-primary: #2d3748;
            --accent-purple: #6f42c1;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--primary-gradient);
            min-height: 100vh;
            color: var(--text-primary);
        }

        .navbar {
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(111, 66, 193, 0.2);
        }

        .platform-card {
            background: var(--card-gradient);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(111, 66, 193, 0.2);
            transition: all 0.3s ease;
        }

        .platform-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(111, 66, 193, 0.2);
        }

        .platform-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 500;
        }

        .connected {
            background: linear-gradient(45deg, #10b981, #059669);
            color: white;
        }

        .disconnected {
            background: linear-gradient(45deg, #ef4444, #dc2626);
            color: white;
        }

        .btn-connect {
            background: linear-gradient(45deg, var(--accent-purple), #8b5cf6);
            border: none;
            color: white;
            border-radius: 12px;
            padding: 0.75rem 1.5rem;
        }

        .sync-stats {
            background: rgba(111, 66, 193, 0.1);
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="/dashboard">
                <i class="fas fa-moon" style="color: var(--accent-purple);"></i> MoonHub
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/dashboard">Dashboard</a>
                <a class="nav-link" href="/reports">Reports</a>
                <a class="nav-link" href="/admin">Admin</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="display-5 fw-bold mb-2" style="background: linear-gradient(45deg, #6f42c1, #4a1a5a); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                    Platform Management
                </h1>
                <p class="lead text-secondary">Connect and manage your marketplace integrations</p>
            </div>
        </div>

        <div class="row">
            <!-- Amazon -->
            <div class="col-lg-6">
                <div class="platform-card">
                    <div class="text-center">
                        <i class="fab fa-amazon platform-icon text-warning"></i>
                        <h4>Amazon Seller Central</h4>
                        <span class="status-badge disconnected" id="amazon-status">Disconnected</span>
                    </div>
                    <div class="mt-3">
                        <p class="text-muted">Connect your Amazon Seller Central account to sync inventory and orders automatically.</p>
                        <button class="btn btn-connect w-100" onclick="connectPlatform('amazon')">
                            <i class="fas fa-plug"></i> Connect Amazon
                        </button>
                        <div class="sync-stats" id="amazon-stats" style="display: none;">
                            <div class="row text-center">
                                <div class="col-4">
                                    <strong>0</strong><br><small>Products Synced</small>
                                </div>
                                <div class="col-4">
                                    <strong>0</strong><br><small>Orders Today</small>
                                </div>
                                <div class="col-4">
                                    <strong>Never</strong><br><small>Last Sync</small>
                                </div>
                            </div>
                            <button class="btn btn-sm btn-outline-primary mt-2 w-100" onclick="syncPlatform('amazon')">
                                <i class="fas fa-sync"></i> Sync Now
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Flipkart -->
            <div class="col-lg-6">
                <div class="platform-card">
                    <div class="text-center">
                        <i class="fas fa-shopping-cart platform-icon text-primary"></i>
                        <h4>Flipkart Seller Hub</h4>
                        <span class="status-badge disconnected" id="flipkart-status">Disconnected</span>
                    </div>
                    <div class="mt-3">
                        <p class="text-muted">Integrate with Flipkart Seller Hub for seamless inventory management.</p>
                        <button class="btn btn-connect w-100" onclick="connectPlatform('flipkart')">
                            <i class="fas fa-plug"></i> Connect Flipkart
                        </button>
                        <div class="sync-stats" id="flipkart-stats" style="display: none;">
                            <div class="row text-center">
                                <div class="col-4">
                                    <strong>0</strong><br><small>Products Synced</small>
                                </div>
                                <div class="col-4">
                                    <strong>0</strong><br><small>Orders Today</small>
                                </div>
                                <div class="col-4">
                                    <strong>Never</strong><br><small>Last Sync</small>
                                </div>
                            </div>
                            <button class="btn btn-sm btn-outline-primary mt-2 w-100" onclick="syncPlatform('flipkart')">
                                <i class="fas fa-sync"></i> Sync Now
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Meesho -->
            <div class="col-lg-6">
                <div class="platform-card">
                    <div class="text-center">
                        <i class="fas fa-store platform-icon text-danger"></i>
                        <h4>Meesho Supplier Panel</h4>
                        <span class="status-badge disconnected" id="meesho-status">Disconnected</span>
                    </div>
                    <div class="mt-3">
                        <p class="text-muted">Connect to Meesho Supplier Panel for bulk order management.</p>
                        <button class="btn btn-connect w-100" onclick="connectPlatform('meesho')">
                            <i class="fas fa-plug"></i> Connect Meesho
                        </button>
                        <div class="sync-stats" id="meesho-stats" style="display: none;">
                            <div class="row text-center">
                                <div class="col-4">
                                    <strong>0</strong><br><small>Products Synced</small>
                                </div>
                                <div class="col-4">
                                    <strong>0</strong><br><small>Orders Today</small>
                                </div>
                                <div class="col-4">
                                    <strong>Never</strong><br><small>Last Sync</small>
                                </div>
                            </div>
                            <button class="btn btn-sm btn-outline-primary mt-2 w-100" onclick="syncPlatform('meesho')">
                                <i class="fas fa-sync"></i> Sync Now
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Shopify -->
            <div class="col-lg-6">
                <div class="platform-card">
                    <div class="text-center">
                        <i class="fab fa-shopify platform-icon text-success"></i>
                        <h4>Shopify Store</h4>
                        <span class="status-badge disconnected" id="shopify-status">Disconnected</span>
                    </div>
                    <div class="mt-3">
                        <p class="text-muted">Integrate your Shopify store for unified inventory management.</p>
                        <button class="btn btn-connect w-100" onclick="connectPlatform('shopify')">
                            <i class="fas fa-plug"></i> Connect Shopify
                        </button>
                        <div class="sync-stats" id="shopify-stats" style="display: none;">
                            <div class="row text-center">
                                <div class="col-4">
                                    <strong>0</strong><br><small>Products Synced</small>
                                </div>
                                <div class="col-4">
                                    <strong>0</strong><br><small>Orders Today</small>
                                </div>
                                <div class="col-4">
                                    <strong>Never</strong><br><small>Last Sync</small>
                                </div>
                            </div>
                            <button class="btn btn-sm btn-outline-primary mt-2 w-100" onclick="syncPlatform('shopify')">
                                <i class="fas fa-sync"></i> Sync Now
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- eBay -->
            <div class="col-lg-6">
                <div class="platform-card">
                    <div class="text-center">
                        <i class="fab fa-ebay platform-icon text-info"></i>
                        <h4>eBay Seller Account</h4>
                        <span class="status-badge disconnected" id="ebay-status">Disconnected</span>
                    </div>
                    <div class="mt-3">
                        <p class="text-muted">Connect your eBay seller account for global marketplace reach.</p>
                        <button class="btn btn-connect w-100" onclick="connectPlatform('ebay')">
                            <i class="fas fa-plug"></i> Connect eBay
                        </button>
                        <div class="sync-stats" id="ebay-stats" style="display: none;">
                            <div class="row text-center">
                                <div class="col-4">
                                    <strong>0</strong><br><small>Products Synced</small>
                                </div>
                                <div class="col-4">
                                    <strong>0</strong><br><small>Orders Today</small>
                                </div>
                                <div class="col-4">
                                    <strong>Never</strong><br><small>Last Sync</small>
                                </div>
                            </div>
                            <button class="btn btn-sm btn-outline-primary mt-2 w-100" onclick="syncPlatform('ebay')">
                                <i class="fas fa-sync"></i> Sync Now
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Custom Platform -->
            <div class="col-lg-6">
                <div class="platform-card">
                    <div class="text-center">
                        <i class="fas fa-plus-circle platform-icon text-secondary"></i>
                        <h4>Custom Platform</h4>
                        <span class="status-badge disconnected">Add New</span>
                    </div>
                    <div class="mt-3">
                        <p class="text-muted">Connect any custom marketplace or API endpoint.</p>
                        <button class="btn btn-connect w-100" onclick="connectPlatform('custom')">
                            <i class="fas fa-plus"></i> Add Custom Platform
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Connection Modal -->
    <div class="modal fade" id="connectionModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Connect Platform</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="modalBody">
                    <!-- Dynamic content will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveConnection()">Connect</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentPlatform = '';

        const platformConfigs = {
            amazon: {
                name: 'Amazon Seller Central',
                fields: [
                    {label: 'Client ID', name: 'client_id', type: 'text', required: true},
                    {label: 'Client Secret', name: 'client_secret', type: 'password', required: true},
                    {label: 'Refresh Token', name: 'refresh_token', type: 'text', required: true},
                    {label: 'Marketplace ID', name: 'marketplace_id', type: 'text', value: 'ATVPDKIKX0DER'}
                ]
            },
            flipkart: {
                name: 'Flipkart Seller Hub',
                fields: [
                    {label: 'App ID', name: 'app_id', type: 'text', required: true},
                    {label: 'App Secret', name: 'app_secret', type: 'password', required: true},
                    {label: 'Access Token', name: 'access_token', type: 'text', required: true}
                ]
            },
            meesho: {
                name: 'Meesho Supplier Panel',
                fields: [
                    {label: 'Supplier ID', name: 'supplier_id', type: 'text', required: true},
                    {label: 'API Key', name: 'api_key', type: 'password', required: true}
                ]
            },
            shopify: {
                name: 'Shopify Store',
                fields: [
                    {label: 'Shop URL', name: 'shop_url', type: 'url', placeholder: 'https://your-shop.myshopify.com', required: true},
                    {label: 'Access Token', name: 'access_token', type: 'password', required: true}
                ]
            },
            ebay: {
                name: 'eBay Seller Account',
                fields: [
                    {label: 'App ID', name: 'app_id', type: 'text', required: true},
                    {label: 'Dev ID', name: 'dev_id', type: 'text', required: true},
                    {label: 'Cert ID', name: 'cert_id', type: 'password', required: true},
                    {label: 'User Token', name: 'user_token', type: 'password', required: true}
                ]
            },
            custom: {
                name: 'Custom Platform',
                fields: [
                    {label: 'Platform Name', name: 'platform_name', type: 'text', required: true},
                    {label: 'API Endpoint', name: 'api_endpoint', type: 'url', required: true},
                    {label: 'API Key', name: 'api_key', type: 'password', required: true},
                    {label: 'Additional Headers', name: 'headers', type: 'textarea'}
                ]
            }
        };

        function connectPlatform(platform) {
            currentPlatform = platform;
            const config = platformConfigs[platform];
            
            document.getElementById('modalTitle').textContent = `Connect ${config.name}`;
            
            let formHTML = '<form id="connectionForm">';
            config.fields.forEach(field => {
                if (field.type === 'textarea') {
                    formHTML += `
                        <div class="mb-3">
                            <label class="form-label">${field.label}</label>
                            <textarea class="form-control" name="${field.name}" ${field.required ? 'required' : ''} 
                                     placeholder="${field.placeholder || ''}"></textarea>
                        </div>
                    `;
                } else {
                    formHTML += `
                        <div class="mb-3">
                            <label class="form-label">${field.label}</label>
                            <input type="${field.type}" class="form-control" name="${field.name}" 
                                   ${field.required ? 'required' : ''} 
                                   placeholder="${field.placeholder || ''}" 
                                   value="${field.value || ''}">
                        </div>
                    `;
                }
            });
            formHTML += '</form>';
            
            document.getElementById('modalBody').innerHTML = formHTML;
            new bootstrap.Modal(document.getElementById('connectionModal')).show();
        }

        function saveConnection() {
            const form = document.getElementById('connectionForm');
            const formData = new FormData(form);
            const credentials = Object.fromEntries(formData);
            
            fetch('/api/connect-platform', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    platform: currentPlatform,
                    credentials: credentials
                })
            })
            .then(response => response.json())
            .then(result => {
                if (result.error) {
                    alert('Error: ' + result.error);
                } else {
                    alert(result.message);
                    updatePlatformStatus(currentPlatform, 'connected');
                    bootstrap.Modal.getInstance(document.getElementById('connectionModal')).hide();
                }
            })
            .catch(error => {
                alert('Connection failed: ' + error.message);
            });
        }

        function updatePlatformStatus(platform, status) {
            const statusElement = document.getElementById(`${platform}-status`);
            const statsElement = document.getElementById(`${platform}-stats`);
            
            if (status === 'connected') {
                statusElement.textContent = 'Connected';
                statusElement.className = 'status-badge connected';
                if (statsElement) {
                    statsElement.style.display = 'block';
                }
            } else {
                statusElement.textContent = 'Disconnected';
                statusElement.className = 'status-badge disconnected';
                if (statsElement) {
                    statsElement.style.display = 'none';
                }
            }
        }

        function syncPlatform(platform) {
            fetch('/api/sync-platform', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({platform: platform})
            })
            .then(response => response.json())
            .then(result => {
                if (result.error) {
                    alert('Sync failed: ' + result.error);
                } else {
                    alert(result.message);
                    // Update sync stats
                    updateSyncStats(platform);
                }
            });
        }

        function updateSyncStats(platform) {
            // Update last sync time
            const now = new Date().toLocaleString();
            const statsElement = document.getElementById(`${platform}-stats`);
            if (statsElement) {
                const lastSyncElement = statsElement.querySelector('strong:last-child');
                if (lastSyncElement) {
                    lastSyncElement.textContent = now;
                }
            }
        }

        // Load platform status on page load
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/api/platform-status')
                .then(response => response.json())
                .then(data => {
                    Object.entries(data).forEach(([platform, config]) => {
                        updatePlatformStatus(platform, config.status);
                    });
                });
        });
    </script>
</body>
</html>